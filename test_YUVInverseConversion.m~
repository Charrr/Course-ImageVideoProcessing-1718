C = [0.257,  0.504,  0.098, 16;
    -0.148, -0.291,  0.439, 128;
     0.439, -0.368, -0.071, 128;
     0,      0,      0,     1];   % RGB to YUV

D = inv(C);  % YUV to RGB

[RGBcomplete, l] = ppmread('img2014/Baboon512C_ASCII2014.ppm');
RGB = RGBcomplete(1:100,1:100,1:3);  % Just take 100 by 100.
YUV = BUPT_format_converter(RGB);
YUV_ = YUV;
YUV_(:,:,4) = ones(100);    % The non-homogeneous 4th dimension.
YUV_reshaped = reshape(YUV_, 10000, 4);
RGB_reshaped = D * YUV_reshaped';
RGB_ = reshape(RGB_reshaped', 100, 100, 4);
RGB2 = round(RGB_(:,:,1:3));

diff = RGB2 - RGB;

figure, imshow(RGB); title('Original RGB');
figure, imshow(uint8(RGB2)); title('Recovered RGB');
figure, imshow(uint8(diff*100)); title('difference (magnified)');